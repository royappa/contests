<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<!-- Mirrored from spoj.sphere.pl/problems/BUNDLE/ by HTTrack Website Copier/3.x [XR&CO'2005], Tue, 10 Jan 2006 04:51:39 GMT -->
<head>
<title>Sphere Online Judge (SPOJ)  - Problem BUNDLE</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<META NAME="Keywords" CONTENT="spoj, online, judge, problem, set, problemset, archive, ACM, Polish, Poland, contest, contester, task, tasks, ADA, Java, Pascal, C, C++, Whitespace, sphere, interest, group, python, ruby, icon, o'caml, caml, ocaml, perl, haskell, bf, brain, clips, prolog, fortran, asm, assembler, asembler, functional, esoteric, programming, languages">

<link href="https://spoj.sphere.pl/gfx/favicon" rel="shortcut icon" type="image/x-icon">

<link href="../../themes/skin3.css" rel="stylesheet" type="text/css" id="theme">
<style type="text/css">
<!--
.maintable {width: 755;} 
-->
</style>
<script type="text/javascript" language="javascript">
<!--
function UnCryptMailto(s) {
	var n=0;
	var r="";
	for(var i=0;i<s.length;i++) {		
		n=s.charCodeAt(i); 
		if (n>=8364) {n = 128;}
		r += String.fromCharCode(n+(2));	
	}
	return r;
}
function linkTo_UnCryptMailto(s)	{
	location.href=UnCryptMailto(s);
}
// -->
</script>

</head>
<body>
<center>
<table cellpadding="10" cellspacing="0" class="maintable" id="maintable">
<tr>
    <td colspan="2" class="header">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
        <tr>
		<td class="headerleft"/>
		<td class="headercenter"><h1>Sphere Online Judge</h1></td>
		<td class="headerright"/>
	</tr>
	</table>
    </td>
</tr>
<tr><td class="menu" width="92" valign="top">
<form name="login"  action="http://spoj.sphere.pl/problems/BUNDLE/" method="post" 
	onsubmit="if(document.login.ssl.checked) document.login.action='https://spoj.sphere.pl/problems/BUNDLE/'" style="margin-bottom: 18px"> 
User: <input name="login_user" type="text" style="width: 85px;" class="form"><BR>
Password: <input name="password" type="password" style="width: 85px;" class="form"><BR>
<script language="javascript" type="text/javascript">
<!--
document.write('<input type="checkbox" name="ssl" id="ssl" checked>secure<br>');
//-->
</script>
<input name="submit" type="submit" value="Log In" class="button" style="width: 85px;">
</form><div class="menucmd"><a href="https://spoj.sphere.pl/register">register</a><br><br><a href="https://spoj.sphere.pl/status">status</a><br><a href="https://spoj.sphere.pl/submit">submit</a><br><a href="../classical/sort=7,start=0.html">problems</a><br><br><a href="https://spoj.sphere.pl/">news</a><br><a href="https://spoj.sphere.pl/contests">contests</a><br><a href="https://spoj.sphere.pl/info">info</a><br><a href="https://spoj.sphere.pl/ranks/">ranks</a><br><br><a href="https://spoj.sphere.pl/forum">forum</a><br><a href="https://spoj.sphere.pl/help">help</a><br><a href="https://spoj.sphere.pl/links">links</a><br><hr></div>Server time:<br>2006-01-10<br>05:48:02<a href="../classical/sort=7,start=0.html"></a><br><br>
<form method="get" action="https://spoj.sphere.pl/search/" class="form" style="width:90px">
<input type="text" name="query" style="width:85px" maxlength=255 value="" class="form"><br>
<input type="submit" value="Search" style="width:85px" class="form" title="Search site"><br>
&nbsp;<a href="https://spoj.sphere.pl/search/problems=on,users=on,contests=on" title="More search options"><small>advanced...</small></a>
</form></td><td class="content" width="99%"><table class="problems" width="100%">
<tr class="navigation">
<td><a href="https://spoj.sphere.pl/submit/BUNDLE/">Submit</a></td>
<td><a href="https://spoj.sphere.pl/status/BUNDLE/">All submissions</a></td>
<td><a href="https://spoj.sphere.pl/ranks/BUNDLE/">Best solutions</a></td>
<td><a href="https://spoj.sphere.pl/problems/BUNDLE.ps">PS</a></td>
<td><a href="https://spoj.sphere.pl/problems/BUNDLE.pdf">PDF</a></td>
<td><a href="../classical/sort=7,start=0.html">Back to list</a></td>
</tr>
</table>

<div class="prob">

<h2>SPOJ Problem Set </h2>
<h1>83. Bundling</h1>
<h2>Problem code: BUNDLE</h2>
<p align="justify">
<p>Outel, a famous semiconductor company, recently released a new model of 
	microprocessor called Platinium. Like many modern processors, Platinium can 
	execute many instructions in one clock step providing that there are no 
	dependencies between them (instruction I<sub>2</sub> is dependent on 
	instruction I<sub>1</sub> if for example I<sub>2</sub> reads a register that I<sub>1</sub>
	writes to). Some processors are so clever that they calculate on the fly which 
	instructions can be safely executed in parallel. Platinium however expects this 
	information to be explicitly specified. A special marker, called simply a stop, 
	inserted between two instructions indicates that some instructions after the 
	stop are possibly dependent on some instructions before the stop. In other 
	words instructions between two successive stops can be executed in parallel and 
	there should not be dependencies between them.
</p>
<p>
	Another interesting feature of Platinium is that an instruction sequence must 
	be split into groups of one, two or three successive instructions. Each group 
	has to be packed into a container called a bundle. Each bundle has 3 slots and 
	a single instruction can be put into each slot, however some slots may stay 
	empty. Each instruction is categorized into one of 10 instruction types denoted 
	by consecutive capital letters from A to J (instructions of the same type have 
	similar functionality, for example type A groups integer arithmetic 
	instructions and type F groups instructions). Only instructions of certain 
	types are allowed to be packed into one bundle. A template specifies one 
	permissible combination of instruction types within a bundle. A template can 
	also specify a position of a stop in the middle of a bundle (there is at most 
	one such stop allowed). In addition, stops are allowed between any two 
	adjoining bundles. A set of templates is called a bundling profile. When 
	packing instructions into bundles, one has to use templates from bundling 
	profile only.
</p>
<p>
	Although Platinium is equipped with an instruction cache it was found that for 
	maximal performance it is most crucial to pack instructions as densely as 
	possible. Second important thing is to use a small number of stops.
</p>
<p>
	Your task is to write a program for bundling Platinium instructions. For the 
	sake of simplicity we assume that the instructions cannot be reordered.
</p>
<h3>Task</h3>
<p>
	Write a program that:
</p>
<div align="justify">
	<ul>
		<li>
		reads a bundling profile and a sequence of instructions,
		<li>
		computes the minimal number of bundles into which the sequence can be packed 
		without breaking the dependencies and the minimal number of all stops that are 
		required for the minimal number of bundles,
		<li>
			writes the result.</li>
	</ul>
</div>
<h3>Input</h3>
<p>
	The input begins with the integer z, the number of test cases. Then z test 
	cases follow.
</p>
<p>
	The first line of each test case descripition contains two integers t and n 
	separated by a single space. Integer t (1 &lt;= t &lt;= 1500) is the number of 
	templates in the bundling profile. Integer n (1 &lt;= n &lt;= 100000) is the 
	number of instructions to be bundled.
</p>
<p>
	Each of the next t lines specifies one template and contains 3 capital letters 
	t<sub>1</sub>,t<sub>2</sub>,t<sub>3</sub> with no spaces in between followed by 
	a space and an integer p. Letter t<sub>i</sub> (A &lt; = t<sub>i</sub>&lt;= J) 
	is an instruction type allowed in the i-th slot. Integer p (0 &lt;= p &lt;= 2) 
	is the index of the slot after which the stop is positioned (0 means no stop 
	within the bundle).
</p>
<p>
	Each of the next n lines specifies one instruction. The i-th line of these n 
	lines contains one capital letter c<sub>i</sub> and an integer d<sub>i</sub>, 
	separated by a single space. Letter c<sub>i</sub> (A &lt;= c<sub>i</sub>&lt;=J) 
	is the type of the i-th instruction. Integer d<sub>i</sub> (0 &lt; = d<sub>i</sub>
	&lt; i) is the index of the last instruction (among the previous ones) that the 
	i-th instruction is dependent on (0 means that the instruction is not dependent 
	on any former instruction).
</p>
<p>
	You can assume that for each instruction type c describing an instruction in 
	the instruction sequence there is at least one template containing c.
</p>
<h3>Output</h3>
<p>
	For each test case, the first and only line of the output contains two integers 
	b and s. Integer b is the minimal number of bundles in a valid packing. Integer 
	s is the minimal number of all stops that are required for the minimal number 
	of bundles.
</p>
<h3>Example</h3>
<pre><b><tt>Sample input:</tt></b>
1
4 9 
ABB 0 
BAD 1 
AAB 0 
ABB 2 
B 0 
B 1 
A 1 
A 1 
B 4 
D 0 
A 0 
B 3 
B 0 

<b><tt>Sample output:</tt></b> 
4 3 
</pre>
<b>Warning: large Input/Output data, be careful with certain languages</b>

<hr>
<table border=0 cellspacing=0 cellpadding=0 align=left>
<tr><td width=130>Added by:</td><td><a href="https://spoj.sphere.pl/search/'Adrian%20Kosowski'">Adrian Kosowski</a></td></tr>
<tr><td>Date:</td><td>2004-06-26</td></tr>
<tr><td>Time limit:</td><td>7s
</td></tr>
<tr><td>Source limit:</td><td>50000B</td></tr>
<tr><td>Resource:</td><td>ACM Central European Programming Contest, Warsaw 2003</td></tr></table>
</div></td>
</tr>

<tr>
<td colspan="2" class="footer">

<script language="javascript" type="text/javascript">
<!--
function swapSheet(sheet, caller) {
    document.getElementById('theme').href=sheet;
    document.cookie="css_0="+sheet+"; path=/;";
    caller.href="#bottom";
}

function setWidth(w, caller) {
    document.getElementById('maintable').style.width=w;
    document.cookie="res="+w+"; path=/;";
    caller.href="#bottom";
}
//-->

</script>
        <table width="100%">
    <tr>
	<td align="left">
            <a href="http://www.pg.gda.pl/eng.html"><IMG src="https://spoj.sphere.pl/gfx/logo-pg" alt="www.pg.gda.pl" border=0 height=36 width=44></a>&nbsp;
            <a href="http://www.eti.pg.gda.pl/"><IMG src="https://spoj.sphere.pl/gfx/logo-eti" alt="www.eti.pg.gda.pl" border=0 height=36 width=44></a>
	</td>
	<td align="center">
	    page size:
	    <a href="https://spoj.sphere.pl/?res=755"  onClick="setWidth('755', this)">800x600</a>
	    <a href="https://spoj.sphere.pl/?res=980"  onClick="setWidth('980', this)">1024x768</a>
	    <a href="https://spoj.sphere.pl/?res=100%" onClick="setWidth('100%', this)">Full</a>
	    &nbsp;&nbsp;
	    theme:
	    <a href="../../indexb6a4.html?css=/themes/skin1.css" onClick="swapSheet('../../themes/skin1.css', this)">olive</a>
	    <a href="../../index3840.html?css=/themes/skin2.css" onClick="swapSheet('../../themes/skin2.css', this)">banana</a>
	    <a href="../../index80f0.html?css=/themes/skin3.css" onClick="swapSheet('../../themes/skin3.css', this)">plum</a>
	    <br>
	    <a href="http://sphere.pl/?id=66">spoj team at sphere</a> &copy; 2004-05 all rights reserved
	</td>
	<td align="right">
            <a href="http://task.gda.pl/english/"><IMG src="https://spoj.sphere.pl/gfx/logo-task" alt="task.gda.pl" border=0 height=36 width=44></a>&nbsp;
            <a href="http://sphere.pl/"><IMG src="https://spoj.sphere.pl/gfx/logo-sphere" alt="sphere.pl" border=0 height=32></a>
	</td>
    </tr>
    </table>
    </tr></table>
</center>
</body>

<!-- Mirrored from spoj.sphere.pl/problems/BUNDLE/ by HTTrack Website Copier/3.x [XR&CO'2005], Tue, 10 Jan 2006 04:51:39 GMT -->
</html>